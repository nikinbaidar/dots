#!/usr/bin/bash

above=${1} ; pattern=${2} ; below=${3} ; file=${!#}

declare -i n

if [ $(grep -i ${pattern} ${file} | wc -l) -gt 1 ] 
then
    cat -n ${file} | grep --color=always -i ${pattern}
    echo -ne "\nSelect the line number: " ; read n ; echo ""
else
    n=$(cat -n ${file} | grep -i ${pattern} | awk '{print $1}')
fi


if [ $n -gt 0 ] 
then
    total_lines=$(cat ${file} | wc -l)
    actual_lines_below=$(( ${total_lines} - ${n} ))
    actual_lines_above=$(( ${n} - 1 ))

    if [ ${above} -gt ${actual_lines_above} ] ; then
        above=${actual_lines_above}
    fi

    if [ ${below} -gt ${actual_lines_below} ] ; then
        below=${actual_lines_below}
    fi

    head -n `expr ${n} + ${below}` ${file} | tail -n `expr ${below} + ${above} + 1`
fi
