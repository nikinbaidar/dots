#!/bin/bash

# ░█▀▄░█░░░█░█░█▀▀░▀█▀░█▀█░█▀█░▀█▀░█░█░░░░░█░█░█▀▀░█░░░█▀█░█▀▀░█▀▄
# ░█▀▄░█░░░█░█░█▀▀░░█░░█░█░█░█░░█░░█▀█░▄▄▄░█▀█░█▀▀░█░░░█▀▀░█▀▀░█▀▄
# ░▀▀░░▀▀▀░▀▀▀░▀▀▀░░▀░░▀▀▀░▀▀▀░░▀░░▀░▀░░░░░▀░▀░▀▀▀░▀▀▀░▀░░░▀▀▀░▀░▀


display_help() {
    cat << 'EOF'
'blutooth-helper' — Manage bluetooth devices with bluetoothctl.

Usage:
  bth [OPTION]

Options:
  -d, --disconnect  Disconnect from currently connected device. Choose the device from selection.

  -c, --connect     Connect to a device from the selection.

  -i, --info        Display info about currently connected device.

  --help, -h        Display this help.

EOF
}

declare -rA bluetooth_devices=(
  ["JBL Clip 4"]="F8:5C:7D:AC:31:F9"
  ["soundcore H30i"]="F4:B6:2D:08:0C:EA"
  ["WI-C100"]="74:B7:E6:29:ED:B2"
  ["soundcore Liberty 4 NC"]="E8:26:CF:13:FF:DE"
)

case $1 in
  "-c" |"--connect") 
    selection=$(printf "%s\n" "${!bluetooth_devices[@]}" | fzf) || exit 1
    bluetoothctl -- connect ${bluetooth_devices["${selection}"]} 
    ;;

  "-d" |"--disconnect") 
    selection=$(printf "%s\n" "${!bluetooth_devices[@]}" | fzf) || exit 1
    bluetoothctl -- disconnect ${bluetooth_devices["${selection}"]} 
    ;;

  "-h" | "--help")
    display_help
    ;;

  "-i" | "--info")
    current_device_mac=$(bluetoothctl info | awk '/Device/ {device=$2} /Connected: yes/ {print device}')
    bluetoothctl devices | grep -F -- "${current_device_mac}" | awk '{printf "Connected to"; for(i=3;i<=NF;i++) printf " %s", $i; print ""}'
    ;;

  *)
    echo "Use '-h' for help."
    exit 1
    ;;

esac
