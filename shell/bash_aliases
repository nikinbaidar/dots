#!/bin/bash
#
# ░█▀▄░█▀█░█▀▀░█░█░░░█▀█░█░░░▀█▀░█▀█░█▀▀░█▀▀░█▀▀
# ░█▀▄░█▀█░▀▀█░█▀█░░░█▀█░█░░░░█░░█▀█░▀▀█░█▀▀░▀▀█
# ░▀▀░░▀░▀░▀▀▀░▀░▀░░░▀░▀░▀▀▀░▀▀▀░▀░▀░▀▀▀░▀▀▀░▀▀▀


alias vi="/usr/bin/nvim"
alias dbworkbench="/usr/bin/nvim -c \"DBUI\""
alias ls="ls -v --color=always --group-directories-first -1"
alias grep="grep --color=always"
alias less="less --quit-if-one-screen -X --RAW-CONTROL-CHARS"
alias octave="octave --silent"
alias sudo="sudo "
alias pqiv="pqiv 2> /dev/null"
## Works with .pptx and .docx POST DEPRECATION
alias convert2pdf="soffice --headless --convert-to pdf"
alias figlet="figlet -f /home/nikin/projects/dots/local/share/figlet/pagga.tlf"


function hb() {
    # Handle block devices
    local mntpt selection
    mntpt="/run/media/$USER"

    selection="$(ls -1 --color=never $mntpt | fzf)" || return 1
    selection="${mntpt}/${selection}"

    if [ "$1" = "-u" ]; then
        local device
        device=$(findmnt -n -o SOURCE "$selection")
        udiskie-umount $device || return 1
        return 0
    fi

    if [ -d "$selection" ]; then
        cd "$selection"
    fi

    return 0
}


# Function Definitions
function weather() {
  curl wttr.in/${1}
}


function cloudsync() {

    function pushNotes() {
        pushd ~/notes
        branch=$(git branch | awk ' /\*/ {print $2} ')
        if [ -n "$(git status -s)" ]; then
            git pull
            git add --all
            git commit -m "o.O"
            git push -u origin ${branch} --verbose
        else
            echo "nothing to commit, working tree clean"
        fi
        popd > /dev/null
    }

function waitForDropbox() {
    local start=$(date +%s)
    local TIMEOUT=10
    while [ "$(dropbox-cli status)" != "Up to date" ]; do
        sleep 1
        local now=$(date +%s)
        local elapsed=$((now - start))
        if [ "${elapsed}" -ge "${TIMEOUT}" ]; then
            return 1  # timeout
        fi
    done
    echo "Up to date."
    return 0
}

function pushDropbox() {
    dropbox-cli start > /dev/null 2>&1
    if [ "$(dropbox-cli status)" = "Up to date" ]; then
        echo "Up to date."
    else
        echo "Synchronization in progress..."
        if ! waitForDropbox; then
            dropbox-cli update
            if ! waitForDropbox ; then
                echo "Dropbox did not sync."
                echo "Press any key to shutdown now."
                read x
                exit 1
            fi
        fi
        dropbox-cli stop
    fi
}

case $1 in 
    -n) pushNotes ;;
    -d) pushDropbox ;;
    *) pushNotes && pushDropbox ;;
esac
}

function def() {
    sdcv -n --utf8-output --color "$@" 2>&1 | \
        fold --width=$(tput cols) | \
        less --quit-if-one-screen -RX
    }





